#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
CSVファイル内の日本語テキストを敬語に変換するスクリプト（改良版）
background_ja, themes_ja, market_ja, technique_jaの4つのカラムを対象
"""

import csv
import re
import sys

def convert_to_keigo(text):
    """日本語テキストを敬語に変換"""
    if not text:
        return text
    
    result = text
    
    # 文末の「。」で区切って各文を処理
    sentences = result.split('。')
    converted_sentences = []
    
    for sentence in sentences:
        if not sentence.strip():
            continue
        
        s = sentence.strip()
        
        # 文末の動詞を敬語に変換（より包括的なパターン）
        # 〜した。 → 〜しました。
        # 〜した → 〜しました
        # 〜だった。 → 〜でした。
        # 〜だった → 〜でした
        
        # 動詞の過去形・完了形
        verb_patterns = [
            (r'確立した$', '確立しました'),
            (r'確立。', '確立しました。'),
            (r'始まった$', '始まりました'),
            (r'始まった。', '始まりました。'),
            (r'実現した$', '実現しました'),
            (r'実現した。', '実現しました。'),
            (r'展開した$', '展開しました'),
            (r'展開。', '展開しました。'),
            (r'移行した$', '移行しました'),
            (r'移行。', '移行しました。'),
            (r'一般化した$', '一般化しました'),
            (r'描けるようになった$', '描けるようになりました'),
            (r'描けるようになった。', '描けるようになりました。'),
            (r'増加した$', '増加しました'),
            (r'増加。', '増加しました。'),
            (r'描いた$', '描きました'),
            (r'描いた。', '描きました。'),
            (r'表現した$', '表現しました'),
            (r'表現。', '表現しました。'),
            (r'創始した$', '創始しました'),
            (r'追求した$', '追求しました'),
            (r'追求した。', '追求しました。'),
            (r'拡大した$', '拡大しました'),
            (r'競合した$', '競合しました'),
            (r'競合。', '競合しました。'),
            (r'普及した$', '普及しました'),
            (r'普及。', '普及しました。'),
            (r'揃った$', '揃いました'),
            (r'現れ始めた$', '現れ始めました'),
            (r'現れ始めた。', '現れ始めました。'),
            (r'繁盛した$', '繁盛しました'),
            (r'できることもあった$', 'できることもありました'),
            (r'できることもあった。', 'できることもありました。'),
            (r'向上した$', '向上しました'),
            (r'向上。', '向上しました。'),
            (r'改善された$', '改善されました'),
            (r'改善された。', '改善されました。'),
            (r'誕生した$', '誕生しました'),
            (r'誕生。', '誕生しました。'),
            (r'盛んになった$', '盛んになりました'),
            (r'求められた$', '求められました'),
            (r'求められた。', '求められました。'),
            (r'捉えた$', '捉えました'),
            (r'捉えた。', '捉えました。'),
            (r'風靡した$', '風靡しました'),
            (r'風靡した。', '風靡しました。'),
            (r'購入した$', '購入しました'),
            (r'購入。', '購入しました。'),
            (r'流通した$', '流通しました'),
            (r'販売された$', '販売されました'),
            (r'販売された。', '販売されました。'),
            (r'認知されるようになった$', '認知されるようになりました'),
            (r'認知されるようになった。', '認知されるようになりました。'),
            (r'高まり続けた$', '高まり続けました'),
            (r'高まり続けた。', '高まり続けました。'),
            (r'開発された$', '開発されました'),
            (r'開発された。', '開発されました。'),
            (r'好まれた$', '好まれました'),
            (r'好まれた。', '好まれました。'),
            (r'試みた$', '試みました'),
            (r'試みた。', '試みました。'),
            (r'広げた$', '広げました'),
            (r'広げた。', '広げました。'),
            (r'増えた$', '増えました'),
            (r'増えた。', '増えました。'),
            (r'施した$', '施しました'),
            (r'施す。', '施しました。'),
            (r'使用した$', '使用しました'),
            (r'使用。', '使用しました。'),
            (r'人気を博した$', '人気を博しました'),
            (r'人気を博した。', '人気を博しました。'),
            (r'深化した$', '深化しました'),
            (r'深化。', '深化しました。'),
            (r'活躍した$', '活躍しました'),
            (r'吹き込んだ$', '吹き込みました'),
            (r'吹き込んだ。', '吹き込みました。'),
            (r'焦点を当てた$', '焦点を当てました'),
            (r'獲得した$', '獲得しました'),
            (r'獲得。', '獲得しました。'),
            (r'流出し始めた$', '流出し始めました'),
            (r'流出し始めた。', '流出し始めました。'),
            (r'発表した$', '発表しました'),
            (r'発表。', '発表しました。'),
            (r'制限された$', '制限されました'),
            (r'制限された。', '制限されました。'),
            (r'注がれた$', '注がれました'),
            (r'注がれた。', '注がれました。'),
            (r'強調した$', '強調しました'),
            (r'強調。', '強調しました。'),
            (r'追求された$', '追求されました'),
            (r'追求された。', '追求されました。'),
            (r'高まった$', '高まりました'),
            (r'高まった。', '高まりました。'),
            (r'急増した$', '急増しました'),
            (r'急増した。', '急増しました。'),
            (r'築いた$', '築きました'),
            (r'築いた。', '築きました。'),
            (r'果たした$', '果たしました'),
            (r'果たした。', '果たしました。'),
            (r'定着した$', '定着しました'),
            (r'定着。', '定着しました。'),
            (r'手がけた$', '手がけました'),
            (r'手がけた。', '手がけました。'),
            (r'登場した$', '登場しました'),
            (r'登場。', '登場しました。'),
            (r'可能になった$', '可能になりました'),
            (r'可能になった。', '可能になりました。'),
            (r'隆盛した$', '隆盛しました'),
            (r'隆盛。', '隆盛しました。'),
            (r'流行した$', '流行しました'),
            (r'多様化した$', '多様化しました'),
            (r'多様化。', '多様化しました。'),
            (r'最大規模になった$', '最大規模になりました'),
            (r'最大規模に。', '最大規模になりました。'),
            (r'大ヒットした$', '大ヒットしました'),
            (r'購入された$', '購入されました'),
            (r'購入された。', '購入されました。'),
            (r'変化した$', '変化しました'),
            (r'変化。', '変化しました。'),
            (r'本格化した$', '本格化しました'),
            (r'源泉となった$', '源泉となりました'),
            (r'源泉となった。', '源泉となりました。'),
            (r'可能になった$', '可能になりました'),
            (r'可能に。', '可能になりました。'),
            (r'洗練された$', '洗練されました'),
            (r'達した$', '達しました'),
            (r'再現した$', '再現しました'),
            (r'再現。', '再現しました。'),
            (r'完成した$', '完成しました'),
            (r'完成。', '完成しました。'),
            (r'迎えた$', '迎えました'),
            (r'迎えた。', '迎えました。'),
            (r'得意とした$', '得意としました'),
            (r'配置した$', '配置しました'),
            (r'配置。', '配置しました。'),
            (r'支持された$', '支持されました'),
            (r'支持された。', '支持されました。'),
            (r'整備した$', '整備しました'),
            (r'成熟した$', '成熟しました'),
            (r'成熟。', '成熟しました。'),
            (r'取引されることもあった$', '取引されることもありました'),
            (r'取引されることもあった。', '取引されることもありました。'),
            (r'導入した$', '導入しました'),
            (r'導入。', '導入しました。'),
            (r'知られた$', '知られました'),
            (r'購入できた$', '購入できました'),
            (r'用意した$', '用意しました'),
            (r'重ね摺りした$', '重ね摺りしました'),
            (r'重ね摺りする。', '重ね摺りしました。'),
            (r'可能になった$', '可能になりました'),
            (r'爛熟した$', '爛熟しました'),
            (r'成熟した$', '成熟しました'),
            (r'向上した$', '向上しました'),
            (r'実現できるようになった$', '実現できるようになりました'),
            (r'実現できるようになった。', '実現できるようになりました。'),
            (r'準備期間となった$', '準備期間となりました'),
            (r'準備期間となった。', '準備期間となりました。'),
            (r'見られた$', '見られました'),
            (r'激化した$', '激化しました'),
            (r'繰り広げられた$', '繰り広げられました'),
            (r'繰り広げられた。', '繰り広げられました。'),
            (r'重宝された$', '重宝されました'),
            (r'重宝された。', '重宝されました。'),
            (r'増加した$', '増加しました'),
            (r'精緻になった$', '精緻になりました'),
            (r'表現可能になった$', '表現可能になりました'),
            (r'表現可能に。', '表現可能になりました。'),
            (r'研究された$', '研究されました'),
            (r'高まった$', '高まりました'),
            (r'高まった。', '高まりました。'),
        ]
        
        for pattern, replacement in verb_patterns:
            s = re.sub(pattern, replacement, s)
        
        # 形容動詞・名詞述語
        adj_patterns = [
            (r'特徴的だった$', '特徴的でした'),
            (r'特徴的だった。', '特徴的でした。'),
            (r'限定的だったが、', '限定的でしたが、'),
            (r'中心だが、', '中心でしたが、'),
            (r'主流だった$', '主流でした'),
            (r'主流。', '主流でした。'),
            (r'人気だった$', '人気でした'),
            (r'人気。', '人気でした。'),
            (r'高めだったが、', '高めでしたが、'),
            (r'手が届く範囲だった$', '手が届く範囲でした'),
            (r'手が届く範囲。', '手が届く範囲でした。'),
            (r'特徴だった$', '特徴でした'),
            (r'特徴。', '特徴でした。'),
            (r'印象だった$', '印象でした'),
            (r'印象。', '印象でした。'),
            (r'中心だった$', '中心でした'),
            (r'中心。', '中心でした。'),
        ]
        
        for pattern, replacement in adj_patterns:
            s = re.sub(pattern, replacement, s)
        
        converted_sentences.append(s)
    
    # 文を「。」で結合
    result = '。'.join(converted_sentences)
    if result and not result.endswith('。'):
        result += '。'
    
    return result

def process_csv(input_file, output_file):
    """CSVファイルを処理して敬語に変換"""
    with open(input_file, 'r', encoding='utf-8') as f:
        reader = csv.DictReader(f)
        rows = list(reader)
    
    # 対象カラム
    target_columns = ['background_ja', 'themes_ja', 'market_ja', 'technique_ja']
    
    # 各行を処理
    for row in rows:
        for col in target_columns:
            if col in row and row[col]:
                row[col] = convert_to_keigo(row[col])
    
    # 出力
    with open(output_file, 'w', encoding='utf-8', newline='') as f:
        fieldnames = reader.fieldnames
        writer = csv.DictWriter(f, fieldnames=fieldnames)
        writer.writeheader()
        writer.writerows(rows)
    
    print(f"処理完了: {input_file} → {output_file}")

if __name__ == '__main__':
    input_file = 'public/ukiyoe_for_figma_with_images_rows_duplicate_rows.csv'
    output_file = 'public/ukiyoe_for_figma_with_images_rows_duplicate_rows.csv'
    
    if len(sys.argv) > 1:
        input_file = sys.argv[1]
    if len(sys.argv) > 2:
        output_file = sys.argv[2]
    
    process_csv(input_file, output_file)

